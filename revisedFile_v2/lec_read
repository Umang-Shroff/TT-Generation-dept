Sub StringMatchingLec()
    Dim wsSource As Worksheet
    Dim wsDestL1 As Worksheet
    Dim wsDestL2 As Worksheet
    Dim wsDestL3 As Worksheet
    Dim cell As Range
    Dim subjects As Variant
    Dim subject As Variant
    Dim timeValue As String
    Dim destRow As Variant
    Dim col As Long
    Dim destCol As Long
    Dim prefix As String
    Dim fullSubject As String

    ' Set the source worksheet and destination worksheets for each lab
    Set wsSource = ThisWorkbook.Sheets("main")
    Set wsDestL1 = ThisWorkbook.Sheets("64")
    Set wsDestL2 = ThisWorkbook.Sheets("65")
    Set wsDestL3 = ThisWorkbook.Sheets("66")

    ' Copy time values to destination sheets
    wsDestL1.Range("A1:A" & wsSource.Cells(wsSource.Rows.Count, 1).End(xlUp).Row).Value = wsSource.Range("A1:A" & wsSource.Cells(wsSource.Rows.Count, 1).End(xlUp).Row).Value
    wsDestL2.Range("A1:A" & wsSource.Cells(wsSource.Rows.Count, 1).End(xlUp).Row).Value = wsSource.Range("A1:A" & wsSource.Cells(wsSource.Rows.Count, 1).End(xlUp).Row).Value
    wsDestL3.Range("A1:A" & wsSource.Cells(wsSource.Rows.Count, 1).End(xlUp).Row).Value = wsSource.Range("A1:A" & wsSource.Cells(wsSource.Rows.Count, 1).End(xlUp).Row).Value

    ' Loop through each row in the source worksheet
    For Each cell In wsSource.UsedRange.Rows
        ' Get the time value (the first cell in the row)
        timeValue = wsSource.Cells(cell.Row, 1).Value
        
        ' Loop through columns B to H (2 to 8)
        For col = 2 To 8 ' Columns B to H
            ' Check if the cell in the current column is not empty
            If wsSource.Cells(cell.Row, col).Value <> "" Then
                ' Split the cell content into subjects (if multiple)
                subjects = Split(wsSource.Cells(cell.Row, col).Value, " ") ' Assumes multiple subjects are separated by spaces

                ' Check each subject for the lab codes
                For Each subject In subjects
                    ' Find the corresponding destination column
                    destCol = col ' Same column index in destination sheet

                    ' If the subject has a prefix (e.g., I3-1:CG(64)), keep the prefix as well
                    If InStr(subject, ":") > 0 Then
                        prefix = Trim(Split(subject, ":")(0)) ' Extract the prefix (e.g., I3-1)
                        fullSubject = subject ' Keep the full subject (e.g., I3-1:CG(64))
                    Else
                        prefix = "" ' No prefix
                        fullSubject = subject ' Just the subject (e.g., CG(64))
                    End If

                    ' Now handle the lab code part separately
                    If InStr(fullSubject, "(64)") > 0 Then
                        ' Find the row in LabSheet_64 matching the time
                        destRow = Application.match(timeValue, wsDestL1.Columns(1), 0)
                        If Not IsError(destRow) Then
                            wsDestL1.Cells(destRow, destCol).Value = fullSubject ' Set full subject with prefix in the same column
                        End If
                    ElseIf InStr(fullSubject, "(65)") > 0 Then
                        ' Find the row in LabSheet_65 matching the time
                        destRow = Application.match(timeValue, wsDestL2.Columns(1), 0)
                        If Not IsError(destRow) Then
                            wsDestL2.Cells(destRow, destCol).Value = fullSubject ' Set full subject with prefix in the same column
                        End If
                    ElseIf InStr(fullSubject, "(66)") > 0 Then
                        ' Find the row in LabSheet_66 matching the time
                        destRow = Application.match(timeValue, wsDestL3.Columns(1), 0)
                        If Not IsError(destRow) Then
                            wsDestL3.Cells(destRow, destCol).Value = fullSubject ' Set full subject with prefix in the same column
                        End If
                    End If
                Next subject
            End If
        Next col
    Next cell

    MsgBox "Subjects have been added to their respective lab sheets based on time."
End Sub

